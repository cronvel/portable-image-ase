(function(t){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=t()}else if(typeof define==="function"&&define.amd){define([],t)}else{var e;if(typeof window!=="undefined"){e=window}else if(typeof global!=="undefined"){e=global}else if(typeof self!=="undefined"){e=self}else{e=this}e.PortableImageAse=t()}})(function(){var t,e,r;return function(){function l(s,a,o){function h(r,t){if(!a[r]){if(!s[r]){var e="function"==typeof require&&require;if(!t&&e)return e(r,!0);if(f)return f(r,!0);var i=new Error("Cannot find module '"+r+"'");throw i.code="MODULE_NOT_FOUND",i}var n=a[r]={exports:{}};s[r][0].call(n.exports,function(t){var e=s[r][1][t];return h(e||t)},n,n.exports,l,s,a,o)}return a[r].exports}for(var f="function"==typeof require&&require,t=0;t<o.length;t++)h(o[t]);return h}return l}()({1:[function(h,f,t){(function(o){(function(){"use strict";const i=h("./misc.js");const n=h("stream-kit/lib/SequentialReadBuffer.js");const t=h("stream-kit/lib/SequentialWriteBuffer.js");function s(){this.width=-1;this.height=-1;this.frameCount=-1;this.bitsPerPixel=-1;this.colorType=-1;this.flags=-1;this.defaultFrameDuration=-1;this.transparencyColorIndex=-1;this.colorCount=-1;this.pixelWidth=-1;this.pixelHeight=-1;this.gridX=0;this.gridY=0;this.gridWidth=-1;this.gridHeight=-1;this.frames=[];this.palette=null;this.flattenLayers=null}f.exports=s;const a=s.Frame=h("./Frame.js");const e=s.Layer=h("./Layer.js");const r=s.Cel=h("./Cel.js");s.PortableImage=i.PortableImage;s.COLOR_TYPE_RGBA=0;s.COLOR_TYPE_GRAYSCALE_ALPHA=1;s.COLOR_TYPE_INDEXED=2;s.createEncoder=(t={})=>{var e=new s;e.width=+t.width||0;e.height=+t.height||0;e.bitDepth=+t.bitDepth||0;e.colorType=t.colorType??s.COLOR_TYPE_INDEXED;e.compressionMethod=0;e.filterMethod=0;e.interlaceMethod=0;if(Array.isArray(t.palette)){e.palette=t.palette}if(t.pixelBuffer&&t.pixelBuffer instanceof o){e.pixelBuffer=t.pixelBuffer}if(!e.bitDepth){if(e.colorType===s.COLOR_TYPE_INDEXED){let t=e.palette.length;e.bitDepth=t<=2?1:t<=4?2:t<=16?4:8}else{e.bitDepth=8}}e.computeBitsPerPixel();return e};s.load=async function(t,e={}){var r=await i.loadFileAsync(t);return s.decode(r,e)};s.loadImage=async function(t,e={}){var r=await i.loadFileAsync(t);return s.decodeImage(r,e)};s.decode=async function(t,e={}){var r=new s;await r.decode(t,e);return r};s.decodeImage=function(t,e={}){var r=new s;return r.decodeImage(t,e)};s.prototype.toImage=function(t=i.PortableImage.Image){return this.frames[0].toImage(t)};s.prototype.toSprite=function(t=i.PortableImage.Sprite){var e=this.getImageParams(t.Image);e.width=this.width;e.height=this.height;var r=new t(e);for(let t of this.frames){t.addSpriteFrame(r)}for(let t of this.flattenLayers){t.addSpriteLayer(r)}return r};s.prototype.getImageParams=function(t=i.PortableImage.Image){var e={width:this.width,height:this.height};switch(this.colorType){case s.COLOR_TYPE_RGBA:e.channels=t.ChannelDef.RGBA;break;case s.COLOR_TYPE_GRAYSCALE_ALPHA:e.channels=["gray","alpha"];break;case s.COLOR_TYPE_INDEXED:e.indexed=true;e.palette=this.palette;e.channels=t.ChannelDef.RGBA;break}return e};s.prototype.decode=async function(t,e={}){var r=new n(t);this.decodeHeader(r,e);for(let t=0;t<this.frameCount;t++){let t=new a(this);this.frames.push(t);await t.decode(r)}this.finalize()};s.prototype.decodeImage=async function(t,e={}){await this.decode(t,e);console.log(this);for(let t of this.frames){console.log("Frame:",t)}return this.toImage(e.Image)};s.prototype.finalize=async function(){if(!this.frames.length){return}var t=this.frames[0];if(this.colorType===s.COLOR_TYPE_INDEXED){this.palette=t.palette}this.flattenLayers=t.flattenLayers;for(let e of this.frames){for(let t of e.cels){t.ase=this;t.frame=e;t.layer=e.flattenLayers[t.layerIndex]}}};s.prototype.decodeHeader=function(t,e={}){var r=t.readUInt32LE();if(r!==t.buffer.length){throw new Error("Expecting a file of size "+r+" but got "+t.buffer.length+".")}var i=t.readUInt16LE();if(i!==42464){throw new Error("Not an ASE, it doesn't start with ASE magic numbers")}this.frameCount=t.readUInt16LE();this.width=t.readUInt16LE();this.height=t.readUInt16LE();this.bitsPerPixel=t.readUInt16LE();switch(this.bitsPerPixel){case 8:this.colorType=s.COLOR_TYPE_INDEXED;break;case 16:this.colorType=s.COLOR_TYPE_GRAYSCALE_ALPHA;break;case 32:this.colorType=s.COLOR_TYPE_RGBA;break;default:throw new Error("Unsupported number of bits per pixel: "+this.bitsPerPixel)}this.flags=t.readUInt32LE();this.defaultFrameDuration=t.readUInt16LE();t.skip(8);this.transparencyColorIndex=t.readUInt8();t.skip(3);this.colorCount=t.readUInt16LE();if(!this.colorCount&&this.colorType===s.COLOR_TYPE_INDEXED){this.colorCount===256}this.pixelWidth=t.readUInt8();this.pixelHeight=t.readUInt8();if(!this.pixelWidth||!this.pixelHeight){this.pixelWidth=this.pixelHeight=1}this.gridX=t.readInt16LE();this.gridY=t.readInt16LE();this.gridWidth=t.readUInt16LE();this.gridHeight=t.readUInt16LE();t.skip(84)}}).call(this)}).call(this,h("buffer").Buffer)},{"./Cel.js":2,"./Frame.js":3,"./Layer.js":4,"./misc.js":5,buffer:20,"stream-kit/lib/SequentialReadBuffer.js":6,"stream-kit/lib/SequentialWriteBuffer.js":7}],2:[function(t,e,r){"use strict";const i=t("./misc.js");function n(){Object.defineProperties(this,{ase:{value:null,writable:true},frame:{value:null,writable:true},layer:{value:null,writable:true}});this.layerIndex=-1;this.width=-1;this.height=-1;this.x=0;this.y=0;this.zIndex=0;this.opacity=-1;this.type=-1;this.pixelBuffer=null;this.linkedFrame=-1}e.exports=n;const s=t("./Ase.js");n.prototype.toImage=function(t=i.PortableImage.Image){var e=this.ase.getImageParams(t);e.width=this.width;e.height=this.height;e.pixelBuffer=this.pixelBuffer;return new t(e)};n.prototype.toSpriteImage=function(t){var e={channelDef:t.channelDef,width:this.width,height:this.height,pixelBuffer:this.pixelBuffer};return new t.Image(e)};n.prototype.addSpriteCell=function(t){var e=t.sprite;var r=this.toSpriteImage(e);var i=e.addImage(r);var n=new e.Cell({imageIndex:i,x:this.x,y:this.y});t.addCell(n)}},{"./Ase.js":1,"./misc.js":5}],3:[function(t,e,r){"use strict";const s=t("./misc.js");const a=t("stream-kit/lib/SequentialReadBuffer.js");const i=t("stream-kit/lib/SequentialWriteBuffer.js");function n(t){Object.defineProperty(this,"ase",{value:t});this.chunkCount=-1;this.duration=t.defaultFrameDuration;this.palette=[];this.flattenLayers=[];this.cels=[]}e.exports=n;const o=t("./Ase.js");const h=t("./Layer.js");const f=t("./Cel.js");n.prototype.toImage=function(r=s.PortableImage.Image){var t=this.ase.getImageParams(r);var i=new r(t);for(let e of this.cels){if(!e.layer.visible){continue}let t=e.toImage(r);t.copyTo(i,{compositing:r.compositing.binaryOver,x:e.x,y:e.y});console.log("Copy from/to:",i,t," --- cel: ",e)}return i};n.prototype.addSpriteFrame=function(t){var e=new t.Frame({duration:this.duration});t.addFrame(e);for(let t of this.cels){t.addSpriteCell(e)}return e};n.prototype.decode=async function(e,r={}){this.decodeHeader(e,r);for(let t=0;t<this.chunkCount;t++){await this.decodeChunk(e,r)}};n.prototype.decodeHeader=function(t,e={}){var r=t.readUInt32LE();var i=t.readUInt16LE();if(i!==61946){throw new Error("Bad frame, it doesn't start with ASE's frame magic numbers")}var n=t.readUInt16LE();this.duration=t.readUInt16LE();t.skip(2);var s=t.readUInt32LE();this.chunkCount=s===0?n===65535?s:n:s};n.prototype.decodeChunk=async function(t,e={}){var r=t.readUInt32LE();var i=t.readUInt16LE();var n=t.readBufferView(r-6);console.log("Found chunk:",i.toString(16));if(l[i]){await l[i].call(this,new a(n),e)}};const l={};const u={};l[4]=function(i,t){var e=i.readUInt16LE();for(let t=0;t<e;t++){let r=i.readUInt8();let t=i.readUInt8();for(let e=0;e<t;e++){let t=r+e;this.palette[t]=[i.readUInt8(),i.readUInt8(),i.readUInt8(),this.ase.colorType===o.COLOR_TYPE_INDEXED&&this.ase.transparencyColorIndex===t?0:255]}}};l[17]=function(t,e){console.log("Old palette chunk 0x0011 is not supported, upgrade your version of Aseprite!")};l[8217]=function(r,t){var e=r.readUInt32LE();var i=r.readUInt32LE();var n=r.readUInt32LE();r.skip(8);for(let e=i;e<=n;e++){let t=r.readUInt16LE();this.palette[e]=[r.readUInt8(),r.readUInt8(),r.readUInt8(),r.readUInt8()];if(t&1){let t=r.readLps16LEUtf8();console.log("Found color name:",e,t)}}};l[8196]=function(t,e){var r=new h;this.flattenLayers.push(r);var i=t.readUInt16LE();r.visible=!!(i&1);r.type=t.readUInt16LE();switch(r.type){case 0:break;case 1:break;case 2:console.log("Tilemap is unsupported ATM");break;default:console.log("Unknown layer type: "+r.type);break}r.childLevel=t.readUInt16LE();t.skip(4);r.blendMode=t.readUInt16LE();r.opacity=t.readUInt8();t.skip(3);r.name=t.readLps16LEUtf8();if(r.type===2){r.tilesetIndex=t.readUInt32LE()}console.log("Layer:",r)};l[8197]=async function(i,t){var n=new f;this.cels.push(n);n.layerIndex=i.readUInt16LE();n.x=i.readInt16LE();n.y=i.readInt16LE();n.opacity=i.readUInt8();n.type=i.readUInt16LE();n.zIndex=i.readInt16LE();i.skip(5);if(n.type===1){n.linkedFrame=i.readUInt16LE();return}if(n.type===3){console.log("Tilemap is unsupported ATM");return}n.width=i.readUInt16LE();n.height=i.readUInt16LE();if(n.type===0){let t=n.width*n.height*this.ase.bitsPerPixel/8;n.pixelBuffer=i.readBufferView(t)}if(n.type===2){let t=n.width*n.height*this.ase.bitsPerPixel/8;let e=i.readBufferView(-1);let r=await s.inflate(e);if(r.length!==t){throw new Error("Expected decompressed buffer to have size of "+t+" but got: "+r.length)}n.pixelBuffer=r}console.log("Cel:",n)};l[8199]=function(t,e){}},{"./Ase.js":1,"./Cel.js":2,"./Layer.js":4,"./misc.js":5,"stream-kit/lib/SequentialReadBuffer.js":6,"stream-kit/lib/SequentialWriteBuffer.js":7}],4:[function(t,e,r){"use strict";function i(){this.name="";this.type=-1;this.visible=true;this.childLevel=-1;this.blendMode=-1;this.opacity=-1;this.tilesetIndex=-1}e.exports=i;i.TYPE_IMAGE=0;i.TYPE_GROUP=1;i.TYPE_TILEMAP=2;i.BLEND_NORMAL=0;i.BLEND_MULTIPLY=1;i.BLEND_SCREEN=2;i.BLEND_OVERLAY=3;i.BLEND_DARKEN=4;i.BLEND_LIGHTEN=5;i.BLEND_COLOR_DODGE=6;i.BLEND_COLOR_BURN=7;i.BLEND_HARD_LIGHT=8;i.BLEND_SOFT_LIGHT=9;i.BLEND_DIFFERENCE=10;i.BLEND_EXCLUSION=11;i.BLEND_HUE=12;i.BLEND_SATURATION=13;i.BLEND_COLOR=14;i.BLEND_LUMINOSITY=15;i.BLEND_ADDITION=16;i.BLEND_SUBTRACT=17;i.BLEND_DIVIDE=18;i.prototype.addSpriteLayer=function(t){if(this.type!==i.TYPE_IMAGE){return}var e=new t.Layer(this.name,{visible:this.visible,opacity:this.opacity/255});t.addLayer(e);return e}},{}],5:[function(n,t,h){(function(r,o){(function(){"use strict";const t=n("stream-kit/lib/SequentialReadBuffer.js");const e=n("stream-kit/lib/SequentialWriteBuffer.js");var s=null;var a=null;const i=n;if(r.browser){h.PortableImage=window.PortableImage;if(!h.PortableImage){try{h.PortableImage=n("portable-image")}catch(t){}}s=window.DecompressionStream;a=window.CompressionStream;h.loadFileAsync=async t=>{var e=await fetch(t);if(!e.ok){throw new Error("Can't retrieve file: '"+t+"', "+e.status+" - "+e.statusText)}var r=await e.bytes();var i=o.from(r);return i};h.saveFileAsync=()=>{throw new Error("Can't save from browser (use .download() instead)")};h.download=(t,e)=>{var r=window.document.createElement("a");r.href=window.URL.createObjectURL(new Blob([e],{type:"application/octet-stream"}));r.download=t;r.click()}}else{({DecompressionStream:s,CompressionStream:a}=i("stream/web"));try{h.PortableImage=n("portable-image")}catch(t){}let r=i("fs");h.loadFileAsync=t=>r.promises.readFile(t);h.saveFileAsync=(t,e)=>r.promises.writeFile(t,e);h.download=()=>{throw new Error("Can't download from non-browser (use .saveFileAsync() instead)")}}h.inflate=async t=>{const e=new s("deflate");const r=new Blob([t]);const i=r.stream().pipeThrough(e);const n=[];for await(let t of i){n.push(t)}return o.concat(n)};h.deflate=async t=>{const e=new a("deflate");const r=new Blob([t]);const i=r.stream().pipeThrough(e);const n=[];for await(let t of i){n.push(t)}return o.concat(n)}}).call(this)}).call(this,n("_process"),n("buffer").Buffer)},{_process:22,buffer:20,"portable-image":18,"stream-kit/lib/SequentialReadBuffer.js":6,"stream-kit/lib/SequentialWriteBuffer.js":7}],6:[function(t,e,r){(function(i){(function(){"use strict";function t(t){this.buffer=t;this.ptr=0;this.currentBitByte=0;this.remainingBits=0}e.exports=t;Object.defineProperties(t.prototype,{ended:{get:function(){return this.ptr>=this.buffer.length}},remainingBytes:{get:function(){return this.buffer.length-this.ptr}}});t.prototype.skip=function(t){this.remainingBits=this.currentBitByte=0;this.ptr+=t};t.prototype.readBuffer=function(t,e=false){this.remainingBits=this.currentBitByte=0;var r;if(t===-1){t=this.buffer.length-this.ptr}if(e){r=this.buffer.slice(this.ptr,this.ptr+t)}else{r=i.allocUnsafe(t);this.buffer.copy(r,0,this.ptr,this.ptr+t)}this.ptr+=t;return r};t.prototype.readBufferView=function(t){return this.readBuffer(t,true)};t.prototype.readFloat=t.prototype.readFloatBE=function(){this.remainingBits=this.currentBitByte=0;var t=this.buffer.readFloatBE(this.ptr);this.ptr+=4;return t};t.prototype.readFloatLE=function(){this.remainingBits=this.currentBitByte=0;var t=this.buffer.readFloatLE(this.ptr);this.ptr+=4;return t};t.prototype.readNumber=t.prototype.readDouble=t.prototype.readDoubleBE=function(){this.remainingBits=this.currentBitByte=0;var t=this.buffer.readDoubleBE(this.ptr);this.ptr+=8;return t};t.prototype.readDoubleLE=function(){this.remainingBits=this.currentBitByte=0;var t=this.buffer.readDoubleLE(this.ptr);this.ptr+=8;return t};t.prototype.readUInt8=function(){this.remainingBits=this.currentBitByte=0;return this.buffer.readUInt8(this.ptr++)};t.prototype.readUInt16=t.prototype.readUInt16BE=function(){this.remainingBits=this.currentBitByte=0;var t=this.buffer.readUInt16BE(this.ptr);this.ptr+=2;return t};t.prototype.readUInt16LE=function(){this.remainingBits=this.currentBitByte=0;var t=this.buffer.readUInt16LE(this.ptr);this.ptr+=2;return t};t.prototype.readUInt32=t.prototype.readUInt32BE=function(){this.remainingBits=this.currentBitByte=0;var t=this.buffer.readUInt32BE(this.ptr);this.ptr+=4;return t};t.prototype.readUInt32LE=function(){this.remainingBits=this.currentBitByte=0;var t=this.buffer.readUInt32LE(this.ptr);this.ptr+=4;return t};t.prototype.readUInt64=t.prototype.readUInt64BE=function(){this.remainingBits=this.currentBitByte=0;var t=this.buffer.readBigUInt64BE(this.ptr);this.ptr+=8;return t};t.prototype.readUInt64LE=function(){this.remainingBits=this.currentBitByte=0;var t=this.buffer.readBigUInt64LE(this.ptr);this.ptr+=8;return t};t.prototype.readInt8=function(){this.remainingBits=this.currentBitByte=0;return this.buffer.readInt8(this.ptr++)};t.prototype.readInt16=t.prototype.readInt16BE=function(){this.remainingBits=this.currentBitByte=0;var t=this.buffer.readInt16BE(this.ptr);this.ptr+=2;return t};t.prototype.readInt16LE=function(){this.remainingBits=this.currentBitByte=0;var t=this.buffer.readInt16LE(this.ptr);this.ptr+=2;return t};t.prototype.readInt32=t.prototype.readInt32BE=function(){this.remainingBits=this.currentBitByte=0;var t=this.buffer.readInt32BE(this.ptr);this.ptr+=4;return t};t.prototype.readInt32LE=function(){this.remainingBits=this.currentBitByte=0;var t=this.buffer.readInt32LE(this.ptr);this.ptr+=4;return t};t.prototype.readInt64=t.prototype.readInt64BE=function(){this.remainingBits=this.currentBitByte=0;var t=this.buffer.readBigInt64BE(this.ptr);this.ptr+=8;return t};t.prototype.readInt64LE=function(){this.remainingBits=this.currentBitByte=0;var t=this.buffer.readBigInt64LE(this.ptr);this.ptr+=8;return t};t.prototype.readString=function(t,e="latin1"){this.remainingBits=this.currentBitByte=0;var r=this.buffer.toString(e,this.ptr,this.ptr+t);this.ptr+=t;return r};t.prototype.readUtf8=function(t){return this.readString(t,"utf8")};t.prototype.readLps8String=function(t="latin1"){var e=this.readUInt8();return this.readString(e,t)};t.prototype.readLps8Utf8=function(){return this.readLps8String("utf8")};t.prototype.readLps16String=t.prototype.readLps16BEString=function(t="latin1"){var e=this.readUInt16();return this.readString(e,t)};t.prototype.readLps16Utf8=t.prototype.readLps16BEUtf8=function(){return this.readLps16String("utf8")};t.prototype.readLps16LEString=function(t="latin1"){var e=this.readUInt16LE();return this.readString(e,t)};t.prototype.readLps16LEUtf8=function(){return this.readLps16LEString("utf8")};t.prototype.readLps32String=t.prototype.readLps32BEString=function(t="latin1"){var e=this.readUInt32();return this.readString(e,t)};t.prototype.readLps32Utf8=t.prototype.readLps32BEUtf8=function(){return this.readLps32String("utf8")};t.prototype.readLps32LEString=function(t="latin1"){var e=this.readUInt32LE();return this.readString(e,t)};t.prototype.readLps32LEUtf8=function(){return this.readLps32LEString("utf8")};t.prototype.readNullTerminatedString=function(e="latin1"){this.remainingBits=this.currentBitByte=0;var r=this.ptr;for(;r<this.buffer.length;r++){if(this.buffer[r]===0){let t=this.buffer.toString(e,this.ptr,r);this.ptr=r+1;return t}}this.ptr=r;throw new Error("Can't find the null terminator for the string")};t.prototype.readNullTerminatedUtf8=function(){return this.readNullTerminatedString("utf8")};t.prototype.readLps8Buffer=function(){var t=this.readUInt8();return this.readBuffer(t)};t.prototype.readLps16Buffer=t.prototype.readLps16BEBuffer=function(){var t=this.readUInt16();return this.readBuffer(t)};t.prototype.readLps16LEBuffer=function(){var t=this.readUInt16LE();return this.readBuffer(t)};t.prototype.readLps32Buffer=t.prototype.readLps32BEBuffer=function(){var t=this.readUInt32();return this.readBuffer(t)};t.prototype.readLps32LEBuffer=function(){var t=this.readUInt32LE();return this.readBuffer(t)};const n=[0,1,3,7,15,31,63,127,255];t.prototype.readUBits=t.prototype.readUBitsBE=function(e){if(e>8||e<1){throw new Error("SequentialReadBuffer#readUBits() expecting bitCount to be between 1 and 8 but got: "+e)}if(!this.remainingBits){this.currentBitByte=this.buffer.readUInt8(this.ptr);let t=this.currentBitByte>>8-e;this.remainingBits=8-e;this.ptr++;return t}if(e<=this.remainingBits){let t=this.currentBitByte>>this.remainingBits-e&n[e];this.remainingBits-=e;return t}let t=e-this.remainingBits;let r=(this.currentBitByte&n[this.remainingBits])<<t;this.currentBitByte=this.buffer.readUInt8(this.ptr);let i=this.currentBitByte>>8-t;this.remainingBits=8-t;this.ptr++;return r+i}}).call(this)}).call(this,t("buffer").Buffer)},{buffer:20}],7:[function(t,e,r){(function(i){(function(){"use strict";function t(t=1024,e=1.5){this.chunkSize=t;this.chunkSizeMultiplier=e;this.buffer=i.allocUnsafe(this.chunkSize);this.ptr=0;this.chunks=[];this.allChunksSize=0;this.currentBitByte=0;this.remainingBits=0}e.exports=t;t.prototype.size=function(){return this.allChunksSize+this.ptr};t.prototype.getBuffer=function(e=false){if(!this.chunks.length){let t=this.buffer.slice(0,this.ptr);if(e){return t}return i.from(t)}if(!this.ptr){return i.concat(this.chunks)}return i.concat([...this.chunks,this.buffer.slice(0,this.ptr)])};t.prototype.ensureBytes=function(t){this.remainingBits=0;this.currentBitByte=0;if(t<=this.buffer.length-this.ptr){return}this.chunks.push(this.buffer.slice(0,this.ptr));this.allChunksSize+=this.ptr;this.chunkSize=Math.ceil(Math.max(t,this.chunkSize*this.chunkSizeMultiplier));this.buffer=i.allocUnsafe(this.chunkSize);this.ptr=0};t.prototype.writeBuffer=function(t,e=0,r=t.length){var i=r-e;this.ensureBytes(i);t.copy(this.buffer,this.ptr,e,r);this.ptr+=i};t.prototype.writeFloat=t.prototype.writeFloatBE=function(t){this.ensureBytes(4);this.buffer.writeFloatBE(t,this.ptr);this.ptr+=4};t.prototype.writeFloatLE=function(t){this.ensureBytes(4);this.buffer.writeFloatLE(t,this.ptr);this.ptr+=4};t.prototype.writeNumber=t.prototype.writeDouble=t.prototype.writeDoubleBE=function(t){this.ensureBytes(8);this.buffer.writeDoubleBE(t,this.ptr);this.ptr+=8};t.prototype.writeDoubleLE=function(t){this.ensureBytes(8);this.buffer.writeDoubleLE(t,this.ptr);this.ptr+=8};t.prototype.writeUInt8=function(t){this.ensureBytes(1);this.buffer.writeUInt8(t,this.ptr);this.ptr++};t.prototype.writeUInt16=t.prototype.writeUInt16BE=function(t){this.ensureBytes(2);this.buffer.writeUInt16BE(t,this.ptr);this.ptr+=2};t.prototype.writeUInt16LE=function(t){this.ensureBytes(2);this.buffer.writeUInt16LE(t,this.ptr);this.ptr+=2};t.prototype.writeUInt32=t.prototype.writeUInt32BE=function(t){this.ensureBytes(4);this.buffer.writeUInt32BE(t,this.ptr);this.ptr+=4};t.prototype.writeUInt32LE=function(t){this.ensureBytes(4);this.buffer.writeUInt32LE(t,this.ptr);this.ptr+=4};t.prototype.writeUInt64=t.prototype.writeUInt64BE=function(t){this.ensureBytes(8);this.buffer.writeBigUInt64BE(t,this.ptr);this.ptr+=8};t.prototype.writeUInt64LE=function(t){this.ensureBytes(8);this.buffer.writeBigUInt64LE(t,this.ptr);this.ptr+=8};t.prototype.writeInt8=function(t){this.ensureBytes(1);this.buffer.writeInt8(t,this.ptr);this.ptr++};t.prototype.writeInt16=t.prototype.writeInt16BE=function(t){this.ensureBytes(2);this.buffer.writeInt16BE(t,this.ptr);this.ptr+=2};t.prototype.writeInt16LE=function(t){this.ensureBytes(2);this.buffer.writeInt16LE(t,this.ptr);this.ptr+=2};t.prototype.writeInt32=t.prototype.writeInt32BE=function(t){this.ensureBytes(4);this.buffer.writeInt32BE(t,this.ptr);this.ptr+=4};t.prototype.writeInt32LE=function(t){this.ensureBytes(4);this.buffer.writeInt32LE(t,this.ptr);this.ptr+=4};t.prototype.writeInt64=t.prototype.writeInt64BE=function(t){this.ensureBytes(8);this.buffer.writeBigInt64BE(t,this.ptr);this.ptr+=8};t.prototype.writeInt64LE=function(t){this.ensureBytes(8);this.buffer.writeBigInt64LE(t,this.ptr);this.ptr+=8};t.prototype.writeString=function(t,e,r="latin1"){if(e===undefined){e=i.byteLength(t,r)}this.ensureBytes(e);this.buffer.write(t,this.ptr,e,r);this.ptr+=e};t.prototype.writeUtf8=function(t,e){return this.writeString(t,e,"utf8")};t.prototype.writeLps8String=function(t,e,r="latin1"){if(e===undefined){e=i.byteLength(t,r)}if(e>255){throw new RangeError("The string exceed the LPS 8 bits limit")}this.writeUInt8(e);this.writeString(t,e,r)};t.prototype.writeLps8Utf8=function(t,e){return this.writeLps8String(t,e,"utf8")};t.prototype.writeLps16String=t.prototype.writeLps16BEString=function(t,e,r="latin1"){if(e===undefined){e=i.byteLength(t,r)}if(e>65535){throw new RangeError("The string exceed the LPS 16 bits limit")}this.writeUInt16(e);this.writeString(t,e,r)};t.prototype.writeLps16Utf8=t.prototype.writeLps16BEUtf8=function(t,e){return this.writeLps16String(t,e,"utf8")};t.prototype.writeLps16LEString=function(t,e,r="latin1"){if(e===undefined){e=i.byteLength(t,r)}if(e>65535){throw new RangeError("The string exceed the LPS 16 bits limit")}this.writeUInt16LE(e);this.writeString(t,e,r)};t.prototype.writeLps16LEUtf8=function(t,e){return this.writeLps16LEString(t,e,"utf8")};t.prototype.writeLps32String=t.prototype.writeLps32BEString=function(t,e,r="latin1"){if(e===undefined){e=i.byteLength(t,r)}this.writeUInt32(e);this.writeString(t,e,r)};t.prototype.writeLps32Utf8=t.prototype.writeLps32BEUtf8=function(t,e){return this.writeLps32String(t,e,"utf8")};t.prototype.writeLps32LEString=function(t,e,r="latin1"){if(e===undefined){e=i.byteLength(t,r)}this.writeUInt32LE(e);this.writeString(t,e,r)};t.prototype.writeLps32LEUtf8=function(t,e){return this.writeLps32LEString(t,e,"utf8")};t.prototype.writeNullTerminatedString=function(t,e="latin1"){if(t.includes("\0")){throw new Error("The string already contains the NUL character, which is forbidden inside a null-terminated string")}t+="\0";var r=i.byteLength(t,e);this.ensureBytes(r);this.buffer.write(t,this.ptr,r,e);this.ptr+=r};t.prototype.writeNullTerminatedUtf8=function(t){return this.writeNullTerminatedString(t,"utf8")};t.prototype.writeLps8Buffer=function(t){if(t.length>255){throw new RangeError("The buffer exceed the LPS 8 bits limit")}this.writeUInt8(t.length);this.writeBuffer(t)};t.prototype.writeLps16Buffer=t.prototype.writeLps16BEBuffer=function(t){if(t.length>65535){throw new RangeError("The buffer exceed the LPS 16 bits limit")}this.writeUInt16(t.length);this.writeBuffer(t)};t.prototype.writeLps16LEBuffer=function(t){if(t.length>65535){throw new RangeError("The buffer exceed the LPS 16 bits limit")}this.writeUInt16LE(t.length);this.writeBuffer(t)};t.prototype.writeLps32Buffer=t.prototype.writeLps32BEBuffer=function(t){this.writeUInt32(t.length);this.writeBuffer(t)};t.prototype.writeLps32LEBuffer=function(t){this.writeUInt32LE(t.length);this.writeBuffer(t)};const s=[0,1,3,7,15,31,63,127,255];t.prototype.writeUBits=t.prototype.writeUBitsBE=function(t,e){if(e>8||e<1){throw new Error("SequentialWriteBuffer#writeUBits() expecting bitCount to be between 1 and 8 but got: "+e)}t&=s[e];if(!this.remainingBits){this.ensureBytes(1);this.currentBitByte=t<<8-e;this.remainingBits=8-e;this.buffer.writeUInt8(this.currentBitByte,this.ptr);this.ptr++;return}if(e<=this.remainingBits){this.currentBitByte|=t<<this.remainingBits-e;this.remainingBits-=e;this.buffer.writeUInt8(this.currentBitByte,this.ptr-1);return}let r=e-this.remainingBits;let i=t>>r;let n=t&s[r];this.currentBitByte|=i;this.buffer.writeUInt8(this.currentBitByte,this.ptr-1);this.ensureBytes(1);this.currentBitByte=n<<8-r;this.remainingBits=8-r;this.buffer.writeUInt8(this.currentBitByte,this.ptr);this.ptr++}}).call(this)}).call(this,t("buffer").Buffer)},{buffer:20}],8:[function(t,e,r){"use strict";function i(){this.name="";this.loop=false;this.startFrame=0;this.endFrame=0}e.exports=i},{}],9:[function(t,e,r){"use strict";function i(t,e={}){this.sprite=t;this.startFrame=+e.startFrame||0;this.endFrame=e.endFrame??t.frames.length;this.useCache=!!e.useCache;this.scaleX=e.scaleX??e.scale??1;this.scaleY=e.scaleY??e.scale??1;this.blitParams={scaleX:this.scaleX,scaleY:this.scaleY};this.x=+e.x||0;this.y=+e.y||0;this.imageData=this.sprite.prepareImageData(this.blitParams);this.ctx=e.ctx;this.running=false;this.frameIndex=0}e.exports=i;i.prototype.start=function(){if(this.running){return}this.running=true;this.runLoop()};i.prototype.stop=function(){this.running=false};i.prototype.runLoop=function(){if(!this.running){return}var t,e=this.sprite.frames[this.frameIndex];if(this.useCache){if(!e.imageDataCache){e.updateImageData(null,this.blitParams)}t=e.imageDataCache}else{if(this.imageData){e.updateImageData(this.imageData,this.blitParams)}else{this.imageData=e.createImageData(this.blitParams)}t=this.imageData}this.ctx.putImageData(t,this.x,this.y);this.frameIndex++;if(this.frameIndex>=this.endFrame){this.frameIndex=this.startFrame}setTimeout(()=>this.runLoop(),e.duration)}},{}],10:[function(t,e,r){"use strict";function i(t={}){this.imageIndex=+t.imageIndex||0;this.x=+t.x||0;this.y=+t.y||0}e.exports=i},{}],11:[function(t,e,r){"use strict";function o(t={}){this.channels=Array.isArray(t.channels)?t.channels:o.RGBA;this.indexed=!!t.indexed||Array.isArray(t.palette);this.bytesPerPixel=this.indexed?1:this.channels.length;this.palette=this.indexed?[]:null;if(Array.isArray(t.palette)){this.setPalette(t.palette)}this.channelIndex={};for(let t=0;t<this.channels.length;t++){this.channelIndex[this.channels[t]]=t}this.isRgbCompatible=this.channels.length>=3&&this.channels[0]==="red"&&this.channels[1]==="green"&&this.channels[2]==="blue";this.isRgbaCompatible=this.channels.length>=4&&this.isRgbCompatible&&this.channels[3]==="alpha";this.isRgb=this.isRgbCompatible&&this.channels.length===3;this.isRgba=this.isRgbaCompatible&&this.channels.length===4;this.isGrayCompatible=this.channels.length>=1&&this.channels[0]==="gray";this.isGrayAlphaCompatible=this.channels.length>=2&&this.isGrayCompatible&&this.channels[1]==="alpha";this.isGray=this.isGrayCompatible&&this.channels.length===1;this.isGrayAlpha=this.isGrayAlphaCompatible&&this.channels.length===2}e.exports=o;const i=o.Mapping=t("./Mapping.js");o.Mapping=i;o.DirectChannelMapping=i.DirectChannelMapping;o.DirectChannelMappingWithDefault=i.DirectChannelMappingWithDefault;o.MatrixChannelMapping=i.MatrixChannelMapping;o.compositing=t("./compositing.js");o.RGB=["red","green","blue"];o.RGBA=["red","green","blue","alpha"];o.GRAY=["gray"];o.GRAY_ALPHA=["gray","alpha"];o.prototype.clone=function(){return new o({channels:[...this.channels],indexed:this.indexed,palette:this.palette})};o.prototype.setPalette=function(e){if(!this.indexed){throw new Error("This is not an indexed image")}this.palette.length=0;for(let t=0;t<e.length;t++){this.setPaletteEntry(t,e[t])}};o.prototype.setPaletteEntry=function(t,e){if(this.isRgb||this.isRgba){return this.setPaletteColor(t,e)}if(!this.indexed){throw new Error("This is not an indexed image")}if(!e){return}var r=this.palette[t];if(!r){r=this.palette[t]=[]}if(Array.isArray(e)){for(let t=0;t<this.channels.length;t++){r[t]=e[t]??0}}else if(typeof e==="object"){for(let t=0;t<this.channels.length;t++){r[t]=e[this.channels[t]]??0}}};const n=255;o.prototype.setPaletteColor=function(t,e){if(!this.indexed){throw new Error("This is not an indexed image")}if(!e){return}var r=this.palette[t];if(!r){r=this.palette[t]=[]}if(Array.isArray(e)){r[0]=e[0]??0;r[1]=e[1]??0;r[2]=e[2]??0;if(this.isRgba){r[3]=e[3]??255}}else if(typeof e==="object"){r[0]=e.R??e.r??0;r[1]=e.G??e.g??0;r[2]=e.B??e.b??0;if(this.isRgba){r[3]=e.A??e.a??255}}else if(typeof e==="string"&&e[0]==="#"){e=e.slice(1);if(e.length===3){e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]}let t=Number.parseInt(e,16);if(e.length===6){r[0]=t>>16&n;r[1]=t>>8&n;r[2]=t&n;if(this.isRgba){r[3]=255}}else if(e.length===8){r[0]=t>>24&n;r[1]=t>>16&n;r[2]=t>>8&n;if(this.isRgba){r[3]=t&n}}}};o.prototype.hasSamePalette=function(i){if(!this.palette||!i.palette){return false}if(this.palette.length!==i.palette.length){return false}for(let r=0;r<this.palette.length;r++){let e=this.palette[r];for(let t=0;t<e.length;t++){if(e[t]!==i.palette[r][t]){return false}}}return true};o.DEFAULT_CHANNEL_VALUES={red:0,green:0,blue:0,alpha:255};o.prototype.getAutoMappingToChannels=function(r,i=o.DEFAULT_CHANNEL_VALUES){var n=new Array(r.length*2);for(let e=0;e<r.length;e++){let t=r[e];if(Object.hasOwn(this.channelIndex,t)){n[e*2]=this.channelIndex[t];n[e*2+1]=null}else{n[e*2]=null;n[e*2+1]=i[t]??0}}return new o.DirectChannelMappingWithDefault(n)};o.getAutoMapping=function(i,n,s=o.DEFAULT_CHANNEL_VALUES){var a=new Array(n.length*2);for(let r=0;r<n.length;r++){let t=n[r];let e=i.indexOf(t);if(e>=0){a[r*2]=e;a[r*2+1]=null}else{a[r*2]=null;a[r*2+1]=s[t]??0}}return new o.DirectChannelMappingWithDefault(a)};o.prototype.getClosestPaletteIndex=n=>{var t=Math.min(this.channels.length,n.length),s=Infinity,a=0;for(let i=0;i<this.palette.length;i++){let r=0;for(let e=0;e<t;e++){let t=this.palette[i][e]-n[e];r+=t*t;if(r<s){s=r;a=i}}}return a}},{"./Mapping.js":15,"./compositing.js":17}],12:[function(t,e,r){"use strict";function i(t={},e=null){Object.defineProperty(this,"sprite",{configurable:true,value:e});this.duration=t.duration;this.cells=[];this.imageDataCache=null}e.exports=i;const n=t("./Sprite.js");const s=t("./Layer.js");const a=t("./Cell.js");const o=t("./Image.js");i.prototype.setParent=function(t){Object.defineProperty(this,"sprite",{value:t})};i.prototype.clearCache=function(){this.imageDataCache=null};i.prototype.addCell=function(t){this.cells.push(t);return this.cells.length-1};i.prototype.toImage=function(t=o,e=false){var r=new o({width:this.sprite.width,height:this.sprite.height,channelDef:e?this.sprite.channelDef:this.sprite.channelDef.clone()});for(let e of this.cells){let t=this.sprite.images[e.imageIndex];t.copyTo(r,{compositing:o.compositing.binaryOver,x:e.x,y:e.y});console.log("Copy from/to:",r,t," --- cell: ",e)}return r};i.prototype.flatten=function(){var t=this.toImage(o,true);var e=this.sprite.addImage(t);this.cells[0]=new a({imageIndex:e});this.cells.length=1;return t};i.prototype.prepareImageData=function(t={}){return this.sprite.prepareImageData(t)};i.prototype.createImageData=function(t={}){var e=this.sprite.prepareImageData(t);this.updateImageData(e,t,true);return e};i.prototype.updateImageData=function(r,i,t=false){i=i?Object.assign({},i):{};if(!r){if(this.imageDataCache){r=this.imageDataCache;if(!t){r.data.fill(0)}}else{r=this.imageDataCache=this.sprite.prepareImageData(i)}}else if(!t){r.data.fill(0)}for(let e of this.cells){let t=this.sprite.images[e.imageIndex];i.innerX=e.x;i.innerY=e.y;i.compositing=o.compositing.binaryOver;t.updateImageData(r,i,true)}}},{"./Cell.js":10,"./Image.js":13,"./Layer.js":14,"./Sprite.js":16}],13:[function(t,r,e){(function(e){(function(){"use strict";function h(t={}){this.width=t.width;this.height=t.height;this.channelDef=t.channelDef??new f(t);this.pixelBuffer=null;if(t.pixelBuffer){if(t.pixelBuffer instanceof e){if(t.pixelBuffer.length!==this.width*this.height*this.channelDef.bytesPerPixel){throw new Error("Provided pixel Buffer mismatch the expected size (should be exactly width * height * bytesPerPixel)")}this.pixelBuffer=t.pixelBuffer}else if(t.pixelBuffer instanceof Uint8Array){if(t.pixelBuffer.length!==this.width*this.height*this.channelDef.bytesPerPixel){throw new Error("Provided pixel Uint8Array buffer mismatch the expected size (should be exactly width * height * bytesPerPixel)")}this.pixelBuffer=e.from(t.pixelBuffer)}else{throw new Error("Provided pixel buffer is not a Buffer or a Uint8Array")}}else{this.pixelBuffer=e.allocUnsafe(this.width*this.height*this.channelDef.bytesPerPixel)}}r.exports=h;const f=h.ChannelDef=h.prototype.ChannelDef=t("./ChannelDef.js");h.compositing=t("./compositing.js");h.prototype.setPalette=function(t){this.channelDef.setPalette(t)};h.prototype.setPaletteEntry=function(t,e){this.channelDef.setPaletteEntry(t,e)};h.prototype.setPaletteColor=function(t,e){this.channelDef.setPaletteColor(t,e)};h.prototype.hasSamePalette=function(t){return this.channelDef.hasSamePalette(t.channelDef)};h.prototype.getAutoMappingTo=function(t,e=f.DEFAULT_CHANNEL_VALUES){return this.channelDef.getAutoMappingToChannels(t.channelDef.channels,e)};h.prototype.copyTo=function(t,e={}){var r=e.mapping,i=e.scaleX??e.scale??1,n=e.scaleY??e.scale??1;if(!r){r=this.getAutoMappingTo(t)}let s={buffer:this.pixelBuffer,width:this.width,height:this.height,bytesPerPixel:this.channelDef.bytesPerPixel,x:Math.max(0,-((+e.x||0)/i+(+e.innerX||0))),y:Math.max(0,-((+e.y||0)/n+(+e.innerY||0))),endX:this.width,endY:this.height,channels:this.channelDef.channels.length,scaleX:i,scaleY:n,mapping:r,compositing:e.compositing||null};let a={buffer:t.pixelBuffer,width:t.width,height:t.height,bytesPerPixel:t.channelDef.bytesPerPixel,x:Math.max(0,(+e.x||0)+(+e.innerX||0)*i),y:Math.max(0,(+e.y||0)+(+e.innerY||0)*n),endX:t.width,endY:t.height,channels:t.channelDef.channels.length};if(s.compositing){if(this.channelDef.indexed){if(t.channelDef.indexed){if(!this.hasSamePalette(t)){throw new Error("Uncompatible palettes are not supported yet")}s.palette=this.channelDef.palette;if(s.compositing.id==="binaryOver"&&this.channelDef.channelIndex.alpha!==undefined){s.alphaChannel=this.channelDef.channelIndex.alpha;h.fullIndexedBlitWithTransparency(s,a)}else{throw new Error("Copy indexed to indexed with compositing is not supported yet, except for 'binaryOver' mode")}}else{s.palette=this.channelDef.palette;h.compositingBlitFromIndexed(s,a)}}else{if(t.channelDef.indexed){throw new Error("Copy to indexed portable image is not supported yet")}h.compositingBlit(s,a)}}else{if(this.channelDef.indexed){if(t.channelDef.indexed){if(!this.hasSamePalette(t)){throw new Error("Uncompatible palettes are not supported yet")}s.mapping=f.Mapping.INDEXED_TO_INDEXED;h.blit(s,a)}else{s.palette=this.channelDef.palette;h.blitFromIndexed(s,a)}}else{if(t.channelDef.indexed){throw new Error("Copy to indexed portable image is not supported yet")}h.blit(s,a)}}};h.prototype.prepareImageData=function(t={}){var e=t.scaleX??t.scale??1,r=t.scaleY??t.scale??1;return new ImageData(this.width*e,this.height*r)};h.prototype.createImageData=function(t={}){var e=this.prepareImageData(t);this.updateImageData(e,t,true);return e};h.prototype.updateImageData=function(t,e={},r=false){var i=e.mapping,n=e.scaleX??e.scale??1,s=e.scaleY??e.scale??1;if(!r){t.data.fill(0)}if(!i){if(t.width===this.width&&t.height===this.height&&!e.x&&!e.y&&n===1&&s===1){if(this.channelDef.indexed){if(this.channelDef.isRgbaCompatible){return this.isoIndexedRgbaCompatibleToRgbaBlit(t.data)}if(this.channelDef.isRgbCompatible){return this.isoIndexedRgbCompatibleToRgbaBlit(t.data)}}else{if(this.channelDef.isRgbaCompatible){return this.isoRgbaCompatibleToRgbaBlit(t.data)}if(this.channelDef.isRgbCompatible){return this.isoRgbCompatibleToRgbaBlit(t.data)}}}if(this.channelDef.isRgbaCompatible){i=f.Mapping.RGBA_COMPATIBLE_TO_RGBA}else if(this.channelDef.isRgbCompatible){i=f.Mapping.RGB_COMPATIBLE_TO_RGBA}else if(this.channelDef.isGrayAlphaCompatible){i=f.Mapping.GRAY_ALPHA_COMPATIBLE_TO_RGBA}else if(this.channelDef.isGrayCompatible){i=f.Mapping.GRAY_COMPATIBLE_TO_RGBA}else{throw new Error("Mapping required for image that are not RGB/RGBA/Grayscale/Grayscale+Alpha compatible")}}let a={buffer:this.pixelBuffer,width:this.width,height:this.height,bytesPerPixel:this.channelDef.bytesPerPixel,x:Math.max(0,-((+e.x||0)/n+(+e.innerX||0))),y:Math.max(0,-((+e.y||0)/s+(+e.innerY||0))),endX:this.width,endY:this.height,channels:this.channelDef.channels.length,scaleX:n,scaleY:s,mapping:i,compositing:e.compositing||null};let o={buffer:t.data,width:t.width,height:t.height,bytesPerPixel:4,x:Math.max(0,(+e.x||0)+(+e.innerX||0)*n),y:Math.max(0,(+e.y||0)+(+e.innerY||0)*s),endX:t.width,endY:t.height,channels:4};if(a.compositing){if(this.channelDef.indexed){a.palette=this.channelDef.palette;h.compositingBlitFromIndexed(a,o)}else{h.compositingBlit(a,o)}}else{if(this.channelDef.indexed){a.palette=this.channelDef.palette;h.blitFromIndexed(a,o)}else{h.blit(a,o)}}};h.blit=function(n,s){var t=Math.min(s.endX-s.x,(n.endX-n.x)*n.scaleX),e=Math.min(s.endY-s.y,(n.endY-n.y)*n.scaleY);for(let i=0;i<e;i++){for(let r=0;r<t;r++){let t=((s.y+i)*s.width+(s.x+r))*s.bytesPerPixel;let e=(Math.floor(n.y+i/n.scaleY)*n.width+Math.floor(n.x+r/n.scaleX))*n.bytesPerPixel;n.mapping.map(n,s,e,t)}}};h.blitFromIndexed=function(s,a){var t=Math.min(a.endX-a.x,(s.endX-s.x)*s.scaleX),e=Math.min(a.endY-a.y,(s.endY-s.y)*s.scaleY);for(let n=0;n<e;n++){for(let i=0;i<t;i++){let t=((a.y+n)*a.width+(a.x+i))*a.bytesPerPixel;let e=(Math.floor(s.y+n/s.scaleY)*s.width+Math.floor(s.x+i/s.scaleX))*s.bytesPerPixel;let r=s.palette[s.buffer[e]];s.mapping.map(s,a,0,t,r)}}};h.compositingBlit=function(n,s){var t=Math.min(s.endX-s.x,(n.endX-n.x)*n.scaleX),e=Math.min(s.endY-s.y,(n.endY-n.y)*n.scaleY);for(let i=0;i<e;i++){for(let r=0;r<t;r++){let t=((s.y+i)*s.width+(s.x+r))*s.bytesPerPixel;let e=(Math.floor(n.y+i/n.scaleY)*n.width+Math.floor(n.x+r/n.scaleX))*n.bytesPerPixel;n.mapping.compose(n,s,e,t,n.compositing)}}};h.compositingBlitFromIndexed=function(s,a){var t=Math.min(a.endX-a.x,(s.endX-s.x)*s.scaleX),e=Math.min(a.endY-a.y,(s.endY-s.y)*s.scaleY);for(let n=0;n<e;n++){for(let i=0;i<t;i++){let t=((a.y+n)*a.width+(a.x+i))*a.bytesPerPixel;let e=(Math.floor(s.y+n/s.scaleY)*s.width+Math.floor(s.x+i/s.scaleX))*s.bytesPerPixel;let r=s.palette[s.buffer[e]];s.mapping.compose(s,a,0,t,s.compositing,r)}}};h.fullIndexedBlitWithTransparency=function(n,s){var t=Math.min(s.endX-s.x,(n.endX-n.x)*n.scaleX),e=Math.min(s.endY-s.y,(n.endY-n.y)*n.scaleY);for(let i=0;i<e;i++){for(let r=0;r<t;r++){let t=((s.y+i)*s.width+(s.x+r))*s.bytesPerPixel;let e=(Math.floor(n.y+i/n.scaleY)*n.width+Math.floor(n.x+r/n.scaleX))*n.bytesPerPixel;if(n.palette[n.buffer[e]][n.alphaChannel]){s.buffer[t]=n.buffer[e]}}}};h.prototype.isoRgbCompatibleToRgbaBlit=function(i){for(let r=0,t=this.width*this.height;r<t;r++){let t=r*this.channelDef.bytesPerPixel;let e=r*4;i[e]=this.pixelBuffer[t];i[e+1]=this.pixelBuffer[t+1];i[e+2]=this.pixelBuffer[t+2];i[e+3]=255}};h.prototype.isoRgbaCompatibleToRgbaBlit=function(i){for(let r=0,t=this.width*this.height;r<t;r++){let t=r*this.channelDef.bytesPerPixel;let e=r*4;i[e]=this.pixelBuffer[t];i[e+1]=this.pixelBuffer[t+1];i[e+2]=this.pixelBuffer[t+2];i[e+3]=this.pixelBuffer[t+3]}};h.prototype.isoIndexedRgbCompatibleToRgbaBlit=function(n){for(let i=0,t=this.width*this.height;i<t;i++){let t=i*this.channelDef.bytesPerPixel;let e=i*4;let r=this.channelDef.palette[this.pixelBuffer[t]];n[e]=r[0];n[e+1]=r[1];n[e+2]=r[2];n[e+3]=255}};h.prototype.isoIndexedRgbaCompatibleToRgbaBlit=function(n){for(let i=0,t=this.width*this.height;i<t;i++){let t=i*this.channelDef.bytesPerPixel;let e=i*4;let r=this.channelDef.palette[this.pixelBuffer[t]];n[e]=r[0];n[e+1]=r[1];n[e+2]=r[2];n[e+3]=r[3]}};h.prototype.updateFromImageData=function(t,e){throw new Error("Not coded!")}}).call(this)}).call(this,t("buffer").Buffer)},{"./ChannelDef.js":11,"./compositing.js":17,buffer:20}],14:[function(t,e,r){"use strict";function i(t,e={}){this.name=t||"";this.visible=e.visible??true;this.compositing=e.compositing??null;this.opacity=e.opacity??1;this.order=e.order??0}e.exports=i},{}],15:[function(t,e,r){"use strict";function i(t,e){this.matrix=t;this.alphaChannelDst=e??null;this.composeChannelOrder=null;if(this.alphaChannelDst===null){this.compose=this.map}else{this.composeChannelOrder=[this.alphaChannelDst];for(let t=0;t<this.dstChannels;t++){if(t!==this.alphaChannelDst){this.composeChannelOrder.push(t)}}}}i.prototype.map=function(){};i.prototype.compose=function(){};e.exports=i;function o(t){return Math.max(0,Math.min(255,Math.round(t)))}function l(t){return Math.max(0,Math.min(255,Math.round(255*t)))}function u(t){return Math.max(0,Math.min(1,t/255))}const p={alpha:t=>t,channel:(t,e,r)=>r};function n(t,e){this.dstChannels=t.length;i.call(this,t,e)}n.prototype=Object.create(i.prototype);n.prototype.constructor=n;i.DirectChannelMapping=n;n.prototype.map=function(t,e,r,i,n=t.buffer){for(let t=0;t<e.channels;t++){e.buffer[i+t]=n[r+this.matrix[t]]}};n.prototype.compose=function(t,e,r,i,n=p,s=t.buffer){let a=e.buffer[i+this.alphaChannelDst]/255;let o=1;for(let t of this.composeChannelOrder){if(t===this.alphaChannelDst){o=s[r+this.matrix[t]]/255;e.buffer[i+t]=l(n.alpha(o,a))}else{e.buffer[i+t]=l(n.channel(o,a,s[r+this.matrix[t]]/255,e.buffer[i+t]/255))}}};function s(t,e){this.dstChannels=Math.floor(t.length/2);i.call(this,t,e)}s.prototype=Object.create(i.prototype);s.prototype.constructor=s;i.DirectChannelMappingWithDefault=s;s.prototype.map=function(t,e,r,i,n=t.buffer){for(let t=0;t<e.channels;t++){e.buffer[i+t]=this.matrix[t*2+1]??n[r+this.matrix[t*2]]}};s.prototype.compose=function(t,e,r,i,n=p,s=t.buffer){let a=e.buffer[i+this.alphaChannelDst]/255;let o=1;for(let t of this.composeChannelOrder){if(t===this.alphaChannelDst){o=(this.matrix[t*2+1]??s[r+this.matrix[t*2]])/255;e.buffer[i+t]=l(n.alpha(o,a))}else{e.buffer[i+t]=l(n.channel(o,a,(this.matrix[t*2+1]??s[r+this.matrix[t*2]])/255,e.buffer[i+t]/255))}}};function a(t,e,r){this.dstChannels=Math.floor(t.length/(e+1));this.srcChannelsUsed=e;i.call(this,t,r)}a.prototype=Object.create(i.prototype);a.prototype.constructor=a;i.MatrixChannelMapping=a;a.prototype.map=function(t,r,i,n,s=t.buffer){let a=0;for(let t=0;t<r.channels;t++){let e=0;for(let t=0;t<this.srcChannelsUsed;t++){e+=s[i+t]*this.matrix[a++]}e+=this.matrix[a++];r.buffer[n+t]=o(e)}};a.prototype.compose=function(t,i,n,s,a=p,o=t.buffer){let h=i.buffer[s+this.alphaChannelDst]/255;let f=1;for(let t of this.composeChannelOrder){let e=t*(this.srcChannelsUsed+1);let r=0;for(let t=0;t<this.srcChannelsUsed;t++){r+=o[n+t]*this.matrix[e++]}r+=this.matrix[e++];r=u(r);if(t===this.alphaChannelDst){i.buffer[s+t]=l(a.alpha(r,h))}else{i.buffer[s+t]=l(a.channel(f,h,r,i.buffer[s+t]/255))}}};i.INDEXED_TO_INDEXED=new n([0]);i.RGBA_COMPATIBLE_TO_RGBA=new n([0,1,2,3],3);i.RGB_COMPATIBLE_TO_RGBA=new s([0,null,1,null,2,null,null,255],3);i.GRAY_ALPHA_COMPATIBLE_TO_RGBA=new n([0,0,0,1],3);i.GRAY_COMPATIBLE_TO_RGBA=new s([0,null,0,null,0,null,null,255],3);i.RGBA_COMPATIBLE_TO_GRAY_ALPHA=new a([1/3,1/3,1/3,0,0,0,0,0,1,0],4,1);i.RGB_COMPATIBLE_TO_GRAY_ALPHA=new a([1/3,1/3,1/3,0,0,0,0,255],3,1)},{}],16:[function(t,e,r){"use strict";function i(t={}){this.width=t.width;this.height=t.height;this.channelDef=t.channelDef??new n(t);this.images=[];this.layers=[];this.frames=[];this.animations=[];this.orderedLayers=[];this.animationByName=new Map}e.exports=i;const n=i.ChannelDef=i.prototype.ChannelDef=t("./ChannelDef.js");const s=i.Image=i.prototype.Image=t("./Image.js");const a=i.Frame=i.prototype.Frame=t("./Frame.js");const o=i.Layer=i.prototype.Layer=t("./Layer.js");const h=i.Cell=i.prototype.Cell=t("./Cell.js");const f=i.Animation=i.prototype.Animation=t("./Animation.js");const l=i.Animator=i.prototype.Animator=t("./Animator.js");i.prototype.addImage=function(t){this.images.push(t);return this.images.length-1};i.prototype.addFrame=function(t){t.setParent(this);this.frames.push(t);return this.frames.length-1};i.prototype.addLayer=function(t){this.layers.push(t);var e=this.layers.length-1;t.order=e;this.orderedLayers.push(e);return e};i.prototype.toImage=function(t){return this.frames[0].toImage(t)};i.prototype.flatten=function(){for(let t of this.frames){t.flatten()}this.cleanImageIndexes()};i.prototype.cleanImageIndexes=function(){var r=new Array(this.images.length).fill(false);for(let e of this.frames){for(let t of e.cells){r[t.imageIndex]=true}}var e=0,i=new Array(this.images.length);for(let t=0;t<r.length;t++){if(r[t]){if(t!==e){this.images[e]=this.images[t]}i[t]=e;e++}}this.images.length=e;for(let e of this.frames){for(let t of e.cells){t.imageIndex=i[t.imageIndex]}}};i.prototype.prepareImageData=function(t={}){var e=t.scaleX??t.scale??1,r=t.scaleY??t.scale??1;return new ImageData(this.width*e,this.height*r)};i.prototype.createAnimator=function(t={}){return new l(this,t)};i.prototype.clearCache=function(){for(let t of this.frames){t.clearCache()}}},{"./Animation.js":8,"./Animator.js":9,"./Cell.js":10,"./ChannelDef.js":11,"./Frame.js":12,"./Image.js":13,"./Layer.js":14}],17:[function(t,e,r){"use strict";const n={};e.exports=n;n.normal=n.over={id:"over",alpha:(t,e)=>t+e*(1-t),channel:(t,e,r,i)=>(r*t+i*e*(1-t))/(t+e*(1-t))||0};n.binaryOver={id:"binaryOver",alpha:(t,e)=>t?1:e,channel:(t,e,r,i)=>t?r:i};n.in={id:"in",alpha:(t,e)=>t*e,channel:n.normal.channel};n.out={id:"out",alpha:(t,e)=>t*(1-e),channel:(t,e,r,i)=>(r*t+i*(1-e)*(1-t))/(t+(1-e)*(1-t))||0};n.atop={id:"atop",alpha:(t,e)=>n.normal.alpha(t,e)*e,channel:n.normal.channel};n.xor={id:"xor",alpha:(t,e)=>t*(1-e)+e*(1-t),channel:n.normal.channel};n.multiply={id:"multiply",alpha:n.normal.alpha,channel:(t,e,r,i)=>n.normal.channel(t,e,r*(1+(i-1)*e),i)};n.screen={id:"screen",alpha:n.normal.alpha,channel:(t,e,r,i)=>n.normal.channel(t,e,1-(1-r)*(1-i*e),i)};n.overlay={id:"overlay",alpha:n.normal.alpha,channel:(t,e,r,i)=>n.normal.channel(t,e,1+(i-1)*e<.5?2*r*(1+(i-1)*e):i*e>.5?1-2*(1-r)*(1-i*e):r,i)}},{}],18:[function(t,e,r){"use strict";const i={};e.exports=i;i.Image=t("./Image.js");i.Sprite=t("./Sprite.js");i.Mapping=t("./Mapping.js");i.compositing=t("./compositing.js")},{"./Image.js":13,"./Mapping.js":15,"./Sprite.js":16,"./compositing.js":17}],19:[function(t,e,r){"use strict";r.byteLength=a;r.toByteArray=o;r.fromByteArray=y;var h=[];var f=[];var l=typeof Uint8Array!=="undefined"?Uint8Array:Array;var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var n=0,s=i.length;n<s;++n){h[n]=i[n];f[i.charCodeAt(n)]=n}f["-".charCodeAt(0)]=62;f["_".charCodeAt(0)]=63;function u(t){var e=t.length;if(e%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var r=t.indexOf("=");if(r===-1)r=e;var i=r===e?0:4-r%4;return[r,i]}function a(t){var e=u(t);var r=e[0];var i=e[1];return(r+i)*3/4-i}function p(t,e,r){return(e+r)*3/4-r}function o(t){var e;var r=u(t);var i=r[0];var n=r[1];var s=new l(p(t,i,n));var a=0;var o=n>0?i-4:i;var h;for(h=0;h<o;h+=4){e=f[t.charCodeAt(h)]<<18|f[t.charCodeAt(h+1)]<<12|f[t.charCodeAt(h+2)]<<6|f[t.charCodeAt(h+3)];s[a++]=e>>16&255;s[a++]=e>>8&255;s[a++]=e&255}if(n===2){e=f[t.charCodeAt(h)]<<2|f[t.charCodeAt(h+1)]>>4;s[a++]=e&255}if(n===1){e=f[t.charCodeAt(h)]<<10|f[t.charCodeAt(h+1)]<<4|f[t.charCodeAt(h+2)]>>2;s[a++]=e>>8&255;s[a++]=e&255}return s}function c(t){return h[t>>18&63]+h[t>>12&63]+h[t>>6&63]+h[t&63]}function d(t,e,r){var i;var n=[];for(var s=e;s<r;s+=3){i=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255);n.push(c(i))}return n.join("")}function y(t){var e;var r=t.length;var i=r%3;var n=[];var s=16383;for(var a=0,o=r-i;a<o;a+=s){n.push(d(t,a,a+s>o?o:a+s))}if(i===1){e=t[r-1];n.push(h[e>>2]+h[e<<4&63]+"==")}else if(i===2){e=(t[r-2]<<8)+t[r-1];n.push(h[e>>10]+h[e>>4&63]+h[e<<2&63]+"=")}return n.join("")}},{}],20:[function(K,t,Z){(function(t){(function(){"use strict";var i=K("base64-js");var s=K("ieee754");Z.Buffer=p;Z.SlowBuffer=e;Z.INSPECT_MAX_BYTES=50;var r=2147483647;Z.kMaxLength=r;p.TYPED_ARRAY_SUPPORT=t();if(!p.TYPED_ARRAY_SUPPORT&&typeof console!=="undefined"&&typeof console.error==="function"){console.error("This browser lacks typed array (Uint8Array) support which is required by "+"`buffer` v5.x. Use `buffer` v4.x if you require old browser support.")}function t(){try{var t=new Uint8Array(1);t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return t.foo()===42}catch(t){return false}}Object.defineProperty(p.prototype,"parent",{enumerable:true,get:function(){if(!p.isBuffer(this))return undefined;return this.buffer}});Object.defineProperty(p.prototype,"offset",{enumerable:true,get:function(){if(!p.isBuffer(this))return undefined;return this.byteOffset}});function a(t){if(t>r){throw new RangeError('The value "'+t+'" is invalid for option "size"')}var e=new Uint8Array(t);e.__proto__=p.prototype;return e}function p(t,e,r){if(typeof t==="number"){if(typeof e==="string"){throw new TypeError('The "string" argument must be of type string. Received type number')}return f(t)}return n(t,e,r)}if(typeof Symbol!=="undefined"&&Symbol.species!=null&&p[Symbol.species]===p){Object.defineProperty(p,Symbol.species,{value:null,configurable:true,enumerable:false,writable:false})}p.poolSize=8192;function n(t,e,r){if(typeof t==="string"){return l(t,e)}if(ArrayBuffer.isView(t)){return u(t)}if(t==null){throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, "+"or Array-like Object. Received type "+typeof t)}if(R(t,ArrayBuffer)||t&&R(t.buffer,ArrayBuffer)){return c(t,e,r)}if(typeof t==="number"){throw new TypeError('The "value" argument must not be of type number. Received type number')}var i=t.valueOf&&t.valueOf();if(i!=null&&i!==t){return p.from(i,e,r)}var n=d(t);if(n)return n;if(typeof Symbol!=="undefined"&&Symbol.toPrimitive!=null&&typeof t[Symbol.toPrimitive]==="function"){return p.from(t[Symbol.toPrimitive]("string"),e,r)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, "+"or Array-like Object. Received type "+typeof t)}p.from=function(t,e,r){return n(t,e,r)};p.prototype.__proto__=Uint8Array.prototype;p.__proto__=Uint8Array;function o(t){if(typeof t!=="number"){throw new TypeError('"size" argument must be of type number')}else if(t<0){throw new RangeError('The value "'+t+'" is invalid for option "size"')}}function h(t,e,r){o(t);if(t<=0){return a(t)}if(e!==undefined){return typeof r==="string"?a(t).fill(e,r):a(t).fill(e)}return a(t)}p.alloc=function(t,e,r){return h(t,e,r)};function f(t){o(t);return a(t<0?0:y(t)|0)}p.allocUnsafe=function(t){return f(t)};p.allocUnsafeSlow=function(t){return f(t)};function l(t,e){if(typeof e!=="string"||e===""){e="utf8"}if(!p.isEncoding(e)){throw new TypeError("Unknown encoding: "+e)}var r=g(t,e)|0;var i=a(r);var n=i.write(t,e);if(n!==r){i=i.slice(0,n)}return i}function u(t){var e=t.length<0?0:y(t.length)|0;var r=a(e);for(var i=0;i<e;i+=1){r[i]=t[i]&255}return r}function c(t,e,r){if(e<0||t.byteLength<e){throw new RangeError('"offset" is outside of buffer bounds')}if(t.byteLength<e+(r||0)){throw new RangeError('"length" is outside of buffer bounds')}var i;if(e===undefined&&r===undefined){i=new Uint8Array(t)}else if(r===undefined){i=new Uint8Array(t,e)}else{i=new Uint8Array(t,e,r)}i.__proto__=p.prototype;return i}function d(t){if(p.isBuffer(t)){var e=y(t.length)|0;var r=a(e);if(r.length===0){return r}t.copy(r,0,0,e);return r}if(t.length!==undefined){if(typeof t.length!=="number"||M(t.length)){return a(0)}return u(t)}if(t.type==="Buffer"&&Array.isArray(t.data)){return u(t.data)}}function y(t){if(t>=r){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+r.toString(16)+" bytes")}return t|0}function e(t){if(+t!=t){t=0}return p.alloc(+t)}p.isBuffer=function t(e){return e!=null&&e._isBuffer===true&&e!==p.prototype};p.compare=function t(e,r){if(R(e,Uint8Array))e=p.from(e,e.offset,e.byteLength);if(R(r,Uint8Array))r=p.from(r,r.offset,r.byteLength);if(!p.isBuffer(e)||!p.isBuffer(r)){throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array')}if(e===r)return 0;var i=e.length;var n=r.length;for(var s=0,a=Math.min(i,n);s<a;++s){if(e[s]!==r[s]){i=e[s];n=r[s];break}}if(i<n)return-1;if(n<i)return 1;return 0};p.isEncoding=function t(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};p.concat=function t(e,r){if(!Array.isArray(e)){throw new TypeError('"list" argument must be an Array of Buffers')}if(e.length===0){return p.alloc(0)}var i;if(r===undefined){r=0;for(i=0;i<e.length;++i){r+=e[i].length}}var n=p.allocUnsafe(r);var s=0;for(i=0;i<e.length;++i){var a=e[i];if(R(a,Uint8Array)){a=p.from(a)}if(!p.isBuffer(a)){throw new TypeError('"list" argument must be an Array of Buffers')}a.copy(n,s);s+=a.length}return n};function g(t,e){if(p.isBuffer(t)){return t.length}if(ArrayBuffer.isView(t)||R(t,ArrayBuffer)){return t.byteLength}if(typeof t!=="string"){throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. '+"Received type "+typeof t)}var r=t.length;var i=arguments.length>2&&arguments[2]===true;if(!i&&r===0)return 0;var n=false;for(;;){switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return T(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return r*2;case"hex":return r>>>1;case"base64":return S(t).length;default:if(n){return i?-1:T(t).length}e=(""+e).toLowerCase();n=true}}}p.byteLength=g;function m(t,e,r){var i=false;if(e===undefined||e<0){e=0}if(e>this.length){return""}if(r===undefined||r>this.length){r=this.length}if(r<=0){return""}r>>>=0;e>>>=0;if(r<=e){return""}if(!t)t="utf8";while(true){switch(t){case"hex":return G(this,e,r);case"utf8":case"utf-8":return L(this,e,r);case"ascii":return F(this,e,r);case"latin1":case"binary":return X(this,e,r);case"base64":return Y(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return z(this,e,r);default:if(i)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase();i=true}}}p.prototype._isBuffer=true;function w(t,e,r){var i=t[e];t[e]=t[r];t[r]=i}p.prototype.swap16=function t(){var e=this.length;if(e%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var r=0;r<e;r+=2){w(this,r,r+1)}return this};p.prototype.swap32=function t(){var e=this.length;if(e%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var r=0;r<e;r+=4){w(this,r,r+3);w(this,r+1,r+2)}return this};p.prototype.swap64=function t(){var e=this.length;if(e%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var r=0;r<e;r+=8){w(this,r,r+7);w(this,r+1,r+6);w(this,r+2,r+5);w(this,r+3,r+4)}return this};p.prototype.toString=function t(){var e=this.length;if(e===0)return"";if(arguments.length===0)return L(this,0,e);return m.apply(this,arguments)};p.prototype.toLocaleString=p.prototype.toString;p.prototype.equals=function t(e){if(!p.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(this===e)return true;return p.compare(this,e)===0};p.prototype.inspect=function t(){var e="";var r=Z.INSPECT_MAX_BYTES;e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim();if(this.length>r)e+=" ... ";return"<Buffer "+e+">"};p.prototype.compare=function t(e,r,i,n,s){if(R(e,Uint8Array)){e=p.from(e,e.offset,e.byteLength)}if(!p.isBuffer(e)){throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. '+"Received type "+typeof e)}if(r===undefined){r=0}if(i===undefined){i=e?e.length:0}if(n===undefined){n=0}if(s===undefined){s=this.length}if(r<0||i>e.length||n<0||s>this.length){throw new RangeError("out of range index")}if(n>=s&&r>=i){return 0}if(n>=s){return-1}if(r>=i){return 1}r>>>=0;i>>>=0;n>>>=0;s>>>=0;if(this===e)return 0;var a=s-n;var o=i-r;var h=Math.min(a,o);var f=this.slice(n,s);var l=e.slice(r,i);for(var u=0;u<h;++u){if(f[u]!==l[u]){a=f[u];o=l[u];break}}if(a<o)return-1;if(o<a)return 1;return 0};function b(t,e,r,i,n){if(t.length===0)return-1;if(typeof r==="string"){i=r;r=0}else if(r>2147483647){r=2147483647}else if(r<-2147483648){r=-2147483648}r=+r;if(M(r)){r=n?0:t.length-1}if(r<0)r=t.length+r;if(r>=t.length){if(n)return-1;else r=t.length-1}else if(r<0){if(n)r=0;else return-1}if(typeof e==="string"){e=p.from(e,i)}if(p.isBuffer(e)){if(e.length===0){return-1}return B(t,e,r,i,n)}else if(typeof e==="number"){e=e&255;if(typeof Uint8Array.prototype.indexOf==="function"){if(n){return Uint8Array.prototype.indexOf.call(t,e,r)}else{return Uint8Array.prototype.lastIndexOf.call(t,e,r)}}return B(t,[e],r,i,n)}throw new TypeError("val must be string, number or Buffer")}function B(t,e,r,i,n){var s=1;var a=t.length;var o=e.length;if(i!==undefined){i=String(i).toLowerCase();if(i==="ucs2"||i==="ucs-2"||i==="utf16le"||i==="utf-16le"){if(t.length<2||e.length<2){return-1}s=2;a/=2;o/=2;r/=2}}function h(t,e){if(s===1){return t[e]}else{return t.readUInt16BE(e*s)}}var f;if(n){var l=-1;for(f=r;f<a;f++){if(h(t,f)===h(e,l===-1?0:f-l)){if(l===-1)l=f;if(f-l+1===o)return l*s}else{if(l!==-1)f-=f-l;l=-1}}}else{if(r+o>a)r=a-o;for(f=r;f>=0;f--){var u=true;for(var p=0;p<o;p++){if(h(t,f+p)!==h(e,p)){u=false;break}}if(u)return f}}return-1}p.prototype.includes=function t(e,r,i){return this.indexOf(e,r,i)!==-1};p.prototype.indexOf=function t(e,r,i){return b(this,e,r,i,true)};p.prototype.lastIndexOf=function t(e,r,i){return b(this,e,r,i,false)};function E(t,e,r,i){r=Number(r)||0;var n=t.length-r;if(!i){i=n}else{i=Number(i);if(i>n){i=n}}var s=e.length;if(i>s/2){i=s/2}for(var a=0;a<i;++a){var o=parseInt(e.substr(a*2,2),16);if(M(o))return a;t[r+a]=o}return a}function I(t,e,r,i){return _(T(e,t.length-r),t,r,i)}function v(t,e,r,i){return _(V(e),t,r,i)}function O(t,e,r,i){return v(t,e,r,i)}function j(t,e,r,i){return _(S(e),t,r,i)}function k(t,e,r,i){return _(J(e,t.length-r),t,r,i)}p.prototype.write=function t(e,r,i,n){if(r===undefined){n="utf8";i=this.length;r=0}else if(i===undefined&&typeof r==="string"){n=r;i=this.length;r=0}else if(isFinite(r)){r=r>>>0;if(isFinite(i)){i=i>>>0;if(n===undefined)n="utf8"}else{n=i;i=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var s=this.length-r;if(i===undefined||i>s)i=s;if(e.length>0&&(i<0||r<0)||r>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!n)n="utf8";var a=false;for(;;){switch(n){case"hex":return E(this,e,r,i);case"utf8":case"utf-8":return I(this,e,r,i);case"ascii":return v(this,e,r,i);case"latin1":case"binary":return O(this,e,r,i);case"base64":return j(this,e,r,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,e,r,i);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase();a=true}}};p.prototype.toJSON=function t(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Y(t,e,r){if(e===0&&r===t.length){return i.fromByteArray(t)}else{return i.fromByteArray(t.slice(e,r))}}function L(t,e,r){r=Math.min(t.length,r);var i=[];var n=e;while(n<r){var s=t[n];var a=null;var o=s>239?4:s>223?3:s>191?2:1;if(n+o<=r){var h,f,l,u;switch(o){case 1:if(s<128){a=s}break;case 2:h=t[n+1];if((h&192)===128){u=(s&31)<<6|h&63;if(u>127){a=u}}break;case 3:h=t[n+1];f=t[n+2];if((h&192)===128&&(f&192)===128){u=(s&15)<<12|(h&63)<<6|f&63;if(u>2047&&(u<55296||u>57343)){a=u}}break;case 4:h=t[n+1];f=t[n+2];l=t[n+3];if((h&192)===128&&(f&192)===128&&(l&192)===128){u=(s&15)<<18|(h&63)<<12|(f&63)<<6|l&63;if(u>65535&&u<1114112){a=u}}}}if(a===null){a=65533;o=1}else if(a>65535){a-=65536;i.push(a>>>10&1023|55296);a=56320|a&1023}i.push(a);n+=o}return N(i)}var x=4096;function N(t){var e=t.length;if(e<=x){return String.fromCharCode.apply(String,t)}var r="";var i=0;while(i<e){r+=String.fromCharCode.apply(String,t.slice(i,i+=x))}return r}function F(t,e,r){var i="";r=Math.min(t.length,r);for(var n=e;n<r;++n){i+=String.fromCharCode(t[n]&127)}return i}function X(t,e,r){var i="";r=Math.min(t.length,r);for(var n=e;n<r;++n){i+=String.fromCharCode(t[n])}return i}function G(t,e,r){var i=t.length;if(!e||e<0)e=0;if(!r||r<0||r>i)r=i;var n="";for(var s=e;s<r;++s){n+=W(t[s])}return n}function z(t,e,r){var i=t.slice(e,r);var n="";for(var s=0;s<i.length;s+=2){n+=String.fromCharCode(i[s]+i[s+1]*256)}return n}p.prototype.slice=function t(e,r){var i=this.length;e=~~e;r=r===undefined?i:~~r;if(e<0){e+=i;if(e<0)e=0}else if(e>i){e=i}if(r<0){r+=i;if(r<0)r=0}else if(r>i){r=i}if(r<e)r=e;var n=this.subarray(e,r);n.__proto__=p.prototype;return n};function U(t,e,r){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}p.prototype.readUIntLE=function t(e,r,i){e=e>>>0;r=r>>>0;if(!i)U(e,r,this.length);var n=this[e];var s=1;var a=0;while(++a<r&&(s*=256)){n+=this[e+a]*s}return n};p.prototype.readUIntBE=function t(e,r,i){e=e>>>0;r=r>>>0;if(!i){U(e,r,this.length)}var n=this[e+--r];var s=1;while(r>0&&(s*=256)){n+=this[e+--r]*s}return n};p.prototype.readUInt8=function t(e,r){e=e>>>0;if(!r)U(e,1,this.length);return this[e]};p.prototype.readUInt16LE=function t(e,r){e=e>>>0;if(!r)U(e,2,this.length);return this[e]|this[e+1]<<8};p.prototype.readUInt16BE=function t(e,r){e=e>>>0;if(!r)U(e,2,this.length);return this[e]<<8|this[e+1]};p.prototype.readUInt32LE=function t(e,r){e=e>>>0;if(!r)U(e,4,this.length);return(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};p.prototype.readUInt32BE=function t(e,r){e=e>>>0;if(!r)U(e,4,this.length);return this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};p.prototype.readIntLE=function t(e,r,i){e=e>>>0;r=r>>>0;if(!i)U(e,r,this.length);var n=this[e];var s=1;var a=0;while(++a<r&&(s*=256)){n+=this[e+a]*s}s*=128;if(n>=s)n-=Math.pow(2,8*r);return n};p.prototype.readIntBE=function t(e,r,i){e=e>>>0;r=r>>>0;if(!i)U(e,r,this.length);var n=r;var s=1;var a=this[e+--n];while(n>0&&(s*=256)){a+=this[e+--n]*s}s*=128;if(a>=s)a-=Math.pow(2,8*r);return a};p.prototype.readInt8=function t(e,r){e=e>>>0;if(!r)U(e,1,this.length);if(!(this[e]&128))return this[e];return(255-this[e]+1)*-1};p.prototype.readInt16LE=function t(e,r){e=e>>>0;if(!r)U(e,2,this.length);var i=this[e]|this[e+1]<<8;return i&32768?i|4294901760:i};p.prototype.readInt16BE=function t(e,r){e=e>>>0;if(!r)U(e,2,this.length);var i=this[e+1]|this[e]<<8;return i&32768?i|4294901760:i};p.prototype.readInt32LE=function t(e,r){e=e>>>0;if(!r)U(e,4,this.length);return this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};p.prototype.readInt32BE=function t(e,r){e=e>>>0;if(!r)U(e,4,this.length);return this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};p.prototype.readFloatLE=function t(e,r){e=e>>>0;if(!r)U(e,4,this.length);return s.read(this,e,true,23,4)};p.prototype.readFloatBE=function t(e,r){e=e>>>0;if(!r)U(e,4,this.length);return s.read(this,e,false,23,4)};p.prototype.readDoubleLE=function t(e,r){e=e>>>0;if(!r)U(e,8,this.length);return s.read(this,e,true,52,8)};p.prototype.readDoubleBE=function t(e,r){e=e>>>0;if(!r)U(e,8,this.length);return s.read(this,e,false,52,8)};function A(t,e,r,i,n,s){if(!p.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<s)throw new RangeError('"value" argument is out of bounds');if(r+i>t.length)throw new RangeError("Index out of range")}p.prototype.writeUIntLE=function t(e,r,i,n){e=+e;r=r>>>0;i=i>>>0;if(!n){var s=Math.pow(2,8*i)-1;A(this,e,r,i,s,0)}var a=1;var o=0;this[r]=e&255;while(++o<i&&(a*=256)){this[r+o]=e/a&255}return r+i};p.prototype.writeUIntBE=function t(e,r,i,n){e=+e;r=r>>>0;i=i>>>0;if(!n){var s=Math.pow(2,8*i)-1;A(this,e,r,i,s,0)}var a=i-1;var o=1;this[r+a]=e&255;while(--a>=0&&(o*=256)){this[r+a]=e/o&255}return r+i};p.prototype.writeUInt8=function t(e,r,i){e=+e;r=r>>>0;if(!i)A(this,e,r,1,255,0);this[r]=e&255;return r+1};p.prototype.writeUInt16LE=function t(e,r,i){e=+e;r=r>>>0;if(!i)A(this,e,r,2,65535,0);this[r]=e&255;this[r+1]=e>>>8;return r+2};p.prototype.writeUInt16BE=function t(e,r,i){e=+e;r=r>>>0;if(!i)A(this,e,r,2,65535,0);this[r]=e>>>8;this[r+1]=e&255;return r+2};p.prototype.writeUInt32LE=function t(e,r,i){e=+e;r=r>>>0;if(!i)A(this,e,r,4,4294967295,0);this[r+3]=e>>>24;this[r+2]=e>>>16;this[r+1]=e>>>8;this[r]=e&255;return r+4};p.prototype.writeUInt32BE=function t(e,r,i){e=+e;r=r>>>0;if(!i)A(this,e,r,4,4294967295,0);this[r]=e>>>24;this[r+1]=e>>>16;this[r+2]=e>>>8;this[r+3]=e&255;return r+4};p.prototype.writeIntLE=function t(e,r,i,n){e=+e;r=r>>>0;if(!n){var s=Math.pow(2,8*i-1);A(this,e,r,i,s-1,-s)}var a=0;var o=1;var h=0;this[r]=e&255;while(++a<i&&(o*=256)){if(e<0&&h===0&&this[r+a-1]!==0){h=1}this[r+a]=(e/o>>0)-h&255}return r+i};p.prototype.writeIntBE=function t(e,r,i,n){e=+e;r=r>>>0;if(!n){var s=Math.pow(2,8*i-1);A(this,e,r,i,s-1,-s)}var a=i-1;var o=1;var h=0;this[r+a]=e&255;while(--a>=0&&(o*=256)){if(e<0&&h===0&&this[r+a+1]!==0){h=1}this[r+a]=(e/o>>0)-h&255}return r+i};p.prototype.writeInt8=function t(e,r,i){e=+e;r=r>>>0;if(!i)A(this,e,r,1,127,-128);if(e<0)e=255+e+1;this[r]=e&255;return r+1};p.prototype.writeInt16LE=function t(e,r,i){e=+e;r=r>>>0;if(!i)A(this,e,r,2,32767,-32768);this[r]=e&255;this[r+1]=e>>>8;return r+2};p.prototype.writeInt16BE=function t(e,r,i){e=+e;r=r>>>0;if(!i)A(this,e,r,2,32767,-32768);this[r]=e>>>8;this[r+1]=e&255;return r+2};p.prototype.writeInt32LE=function t(e,r,i){e=+e;r=r>>>0;if(!i)A(this,e,r,4,2147483647,-2147483648);this[r]=e&255;this[r+1]=e>>>8;this[r+2]=e>>>16;this[r+3]=e>>>24;return r+4};p.prototype.writeInt32BE=function t(e,r,i){e=+e;r=r>>>0;if(!i)A(this,e,r,4,2147483647,-2147483648);if(e<0)e=4294967295+e+1;this[r]=e>>>24;this[r+1]=e>>>16;this[r+2]=e>>>8;this[r+3]=e&255;return r+4};function C(t,e,r,i,n,s){if(r+i>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function D(t,e,r,i,n){e=+e;r=r>>>0;if(!n){C(t,e,r,4,34028234663852886e22,-34028234663852886e22)}s.write(t,e,r,i,23,4);return r+4}p.prototype.writeFloatLE=function t(e,r,i){return D(this,e,r,true,i)};p.prototype.writeFloatBE=function t(e,r,i){return D(this,e,r,false,i)};function P(t,e,r,i,n){e=+e;r=r>>>0;if(!n){C(t,e,r,8,17976931348623157e292,-17976931348623157e292)}s.write(t,e,r,i,52,8);return r+8}p.prototype.writeDoubleLE=function t(e,r,i){return P(this,e,r,true,i)};p.prototype.writeDoubleBE=function t(e,r,i){return P(this,e,r,false,i)};p.prototype.copy=function t(e,r,i,n){if(!p.isBuffer(e))throw new TypeError("argument should be a Buffer");if(!i)i=0;if(!n&&n!==0)n=this.length;if(r>=e.length)r=e.length;if(!r)r=0;if(n>0&&n<i)n=i;if(n===i)return 0;if(e.length===0||this.length===0)return 0;if(r<0){throw new RangeError("targetStart out of bounds")}if(i<0||i>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");if(n>this.length)n=this.length;if(e.length-r<n-i){n=e.length-r+i}var s=n-i;if(this===e&&typeof Uint8Array.prototype.copyWithin==="function"){this.copyWithin(r,i,n)}else if(this===e&&i<r&&r<n){for(var a=s-1;a>=0;--a){e[a+r]=this[a+i]}}else{Uint8Array.prototype.set.call(e,this.subarray(i,n),r)}return s};p.prototype.fill=function t(e,r,i,n){if(typeof e==="string"){if(typeof r==="string"){n=r;r=0;i=this.length}else if(typeof i==="string"){n=i;i=this.length}if(n!==undefined&&typeof n!=="string"){throw new TypeError("encoding must be a string")}if(typeof n==="string"&&!p.isEncoding(n)){throw new TypeError("Unknown encoding: "+n)}if(e.length===1){var s=e.charCodeAt(0);if(n==="utf8"&&s<128||n==="latin1"){e=s}}}else if(typeof e==="number"){e=e&255}if(r<0||this.length<r||this.length<i){throw new RangeError("Out of range index")}if(i<=r){return this}r=r>>>0;i=i===undefined?this.length:i>>>0;if(!e)e=0;var a;if(typeof e==="number"){for(a=r;a<i;++a){this[a]=e}}else{var o=p.isBuffer(e)?e:p.from(e,n);var h=o.length;if(h===0){throw new TypeError('The value "'+e+'" is invalid for argument "value"')}for(a=0;a<i-r;++a){this[a+r]=o[a%h]}}return this};var H=/[^+/0-9A-Za-z-_]/g;function q(t){t=t.split("=")[0];t=t.trim().replace(H,"");if(t.length<2)return"";while(t.length%4!==0){t=t+"="}return t}function W(t){if(t<16)return"0"+t.toString(16);return t.toString(16)}function T(t,e){e=e||Infinity;var r;var i=t.length;var n=null;var s=[];for(var a=0;a<i;++a){r=t.charCodeAt(a);if(r>55295&&r<57344){if(!n){if(r>56319){if((e-=3)>-1)s.push(239,191,189);continue}else if(a+1===i){if((e-=3)>-1)s.push(239,191,189);continue}n=r;continue}if(r<56320){if((e-=3)>-1)s.push(239,191,189);n=r;continue}r=(n-55296<<10|r-56320)+65536}else if(n){if((e-=3)>-1)s.push(239,191,189)}n=null;if(r<128){if((e-=1)<0)break;s.push(r)}else if(r<2048){if((e-=2)<0)break;s.push(r>>6|192,r&63|128)}else if(r<65536){if((e-=3)<0)break;s.push(r>>12|224,r>>6&63|128,r&63|128)}else if(r<1114112){if((e-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,r&63|128)}else{throw new Error("Invalid code point")}}return s}function V(t){var e=[];for(var r=0;r<t.length;++r){e.push(t.charCodeAt(r)&255)}return e}function J(t,e){var r,i,n;var s=[];for(var a=0;a<t.length;++a){if((e-=2)<0)break;r=t.charCodeAt(a);i=r>>8;n=r%256;s.push(n);s.push(i)}return s}function S(t){return i.toByteArray(q(t))}function _(t,e,r,i){for(var n=0;n<i;++n){if(n+r>=e.length||n>=t.length)break;e[n+r]=t[n]}return n}function R(t,e){return t instanceof e||t!=null&&t.constructor!=null&&t.constructor.name!=null&&t.constructor.name===e.name}function M(t){return t!==t}}).call(this)}).call(this,K("buffer").Buffer)},{"base64-js":19,buffer:20,ieee754:21}],21:[function(t,e,r){r.read=function(t,e,r,i,n){var s,a;var o=n*8-i-1;var h=(1<<o)-1;var f=h>>1;var l=-7;var u=r?n-1:0;var p=r?-1:1;var c=t[e+u];u+=p;s=c&(1<<-l)-1;c>>=-l;l+=o;for(;l>0;s=s*256+t[e+u],u+=p,l-=8){}a=s&(1<<-l)-1;s>>=-l;l+=i;for(;l>0;a=a*256+t[e+u],u+=p,l-=8){}if(s===0){s=1-f}else if(s===h){return a?NaN:(c?-1:1)*Infinity}else{a=a+Math.pow(2,i);s=s-f}return(c?-1:1)*a*Math.pow(2,s-i)};r.write=function(t,e,r,i,n,s){var a,o,h;var f=s*8-n-1;var l=(1<<f)-1;var u=l>>1;var p=n===23?Math.pow(2,-24)-Math.pow(2,-77):0;var c=i?0:s-1;var d=i?1:-1;var y=e<0||e===0&&1/e<0?1:0;e=Math.abs(e);if(isNaN(e)||e===Infinity){o=isNaN(e)?1:0;a=l}else{a=Math.floor(Math.log(e)/Math.LN2);if(e*(h=Math.pow(2,-a))<1){a--;h*=2}if(a+u>=1){e+=p/h}else{e+=p*Math.pow(2,1-u)}if(e*h>=2){a++;h/=2}if(a+u>=l){o=0;a=l}else if(a+u>=1){o=(e*h-1)*Math.pow(2,n);a=a+u}else{o=e*Math.pow(2,u-1)*Math.pow(2,n);a=0}}for(;n>=8;t[r+c]=o&255,c+=d,o/=256,n-=8){}a=a<<n|o;f+=n;for(;f>0;t[r+c]=a&255,c+=d,a/=256,f-=8){}t[r+c-d]|=y*128}},{}],22:[function(t,e,r){var i=e.exports={};var n;var s;function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){n=setTimeout}else{n=a}}catch(t){n=a}try{if(typeof clearTimeout==="function"){s=clearTimeout}else{s=o}}catch(t){s=o}})();function h(e){if(n===setTimeout){return setTimeout(e,0)}if((n===a||!n)&&setTimeout){n=setTimeout;return setTimeout(e,0)}try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}function f(e){if(s===clearTimeout){return clearTimeout(e)}if((s===o||!s)&&clearTimeout){s=clearTimeout;return clearTimeout(e)}try{return s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}var l=[];var u=false;var p;var c=-1;function d(){if(!u||!p){return}u=false;if(p.length){l=p.concat(l)}else{c=-1}if(l.length){y()}}function y(){if(u){return}var t=h(d);u=true;var e=l.length;while(e){p=l;l=[];while(++c<e){if(p){p[c].run()}}c=-1;e=l.length}p=null;u=false;f(t)}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1){for(var r=1;r<arguments.length;r++){e[r-1]=arguments[r]}}l.push(new g(t,e));if(l.length===1&&!u){h(y)}};function g(t,e){this.fun=t;this.array=e}g.prototype.run=function(){this.fun.apply(null,this.array)};i.title="browser";i.browser=true;i.env={};i.argv=[];i.version="";i.versions={};function m(){}i.on=m;i.addListener=m;i.once=m;i.off=m;i.removeListener=m;i.removeAllListeners=m;i.emit=m;i.prependListener=m;i.prependOnceListener=m;i.listeners=function(t){return[]};i.binding=function(t){throw new Error("process.binding is not supported")};i.cwd=function(){return"/"};i.chdir=function(t){throw new Error("process.chdir is not supported")};i.umask=function(){return 0}},{}]},{},[1])(1)});